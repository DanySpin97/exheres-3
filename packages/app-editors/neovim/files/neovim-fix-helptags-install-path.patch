Upstream: PR #2741
Reason: Respect DATAROOTDIR for multiarch

From 5194ce29b524fc9a935bf6664618befeeafbb549 Mon Sep 17 00:00:00 2001
From: Thomas Anderson <tanderson@caltech.edu>
Date: Mon, 25 May 2015 04:04:10 -0700
Subject: [PATCH] Fix helptags generation when prefix is not /usr

---
 CMakeLists.txt                                              | 4 +++-
 cmake/{GenerateHelptags.cmake => GenerateHelptags.cmake.in} | 4 ++--
 config/pathdef.c.in                                         | 2 +-
 3 files changed, 6 insertions(+), 4 deletions(-)
 rename cmake/{GenerateHelptags.cmake => GenerateHelptags.cmake.in} (88%)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 3c5fda5..bbafdc2 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -283,7 +283,9 @@ foreach(PROG ${RUNTIME_PROGRAMS})
   install_helper(PROGRAMS ${PROG} DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/nvim/${BASEDIR})
 endforeach()
 
-install(SCRIPT ${PROJECT_SOURCE_DIR}/cmake/GenerateHelptags.cmake)
+configure_file(${PROJECT_SOURCE_DIR}/cmake/GenerateHelptags.cmake.in
+        ${PROJECT_BINARY_DIR}/cmake/GenerateHelptags.cmake @ONLY)
+install(SCRIPT ${PROJECT_BINARY_DIR}/cmake/GenerateHelptags.cmake)
 
 
 # Go down the tree.
diff --git a/cmake/GenerateHelptags.cmake b/cmake/GenerateHelptags.cmake.in
similarity index 88%
rename from cmake/GenerateHelptags.cmake
rename to cmake/GenerateHelptags.cmake.in
index d4f4518..da3fc7a 100644
--- a/cmake/GenerateHelptags.cmake
+++ b/cmake/GenerateHelptags.cmake.in
@@ -1,10 +1,10 @@
 if(DEFINED ENV{DESTDIR})
   file(TO_CMAKE_PATH
-    "$ENV{DESTDIR}/${CMAKE_INSTALL_PREFIX}/share/nvim/runtime/doc"
+    "$ENV{DESTDIR}/@CMAKE_INSTALL_FULL_DATADIR@/nvim/runtime/doc"
     HELPTAGS_WORKING_DIRECTORY)
 else()
   file(TO_CMAKE_PATH
-    "${CMAKE_INSTALL_PREFIX}/share/nvim/runtime/doc"
+    "@CMAKE_INSTALL_FULL_DATADIR@/nvim/runtime/doc"
     HELPTAGS_WORKING_DIRECTORY)
 endif()
 
diff --git a/config/pathdef.c.in b/config/pathdef.c.in
index faf4267..4579fbe 100644
--- a/config/pathdef.c.in
+++ b/config/pathdef.c.in
@@ -1,5 +1,5 @@
 #include "${PROJECT_SOURCE_DIR}/src/nvim/vim.h"
-char *default_vim_dir = "${CMAKE_INSTALL_PREFIX}/share/nvim";
+char *default_vim_dir = "${CMAKE_INSTALL_FULL_DATAROOTDIR}/nvim";
 char *default_vimruntime_dir = "";
 char_u *compiled_user = (char_u *)"${USERNAME}";
 char_u *compiled_sys = (char_u *)"${HOSTNAME}";
-- 
2.4.1

