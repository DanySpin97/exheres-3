# Copyright 2015 Volodymyr Medvid <vmedvid@riseup.net>
# Distributed under the terms of the GNU General Public License v2

require github [ user=mono ] autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.15 ] ]

SUMMARY=".NET binding to gudev"
DESCRIPTION="
GUdev# allows access to device information from a C# program using Mono on Linux.
"

PLATFORMS="~amd64"
LICENCES="LGPL-2.1"
SLOT="3"
MYOPTIONS="
    ( providers: eudev systemd ) [[ number-selected = exactly-one ]]
"

DEPENDENCIES="
    build:
        virtual/pkg-config
    build+run:
        dev-lang/mono[>=2.0]
        gnome-bindings/gtk-sharp:3[>=2.99.0]
        providers:systemd? ( sys-apps/systemd[>=146] ) [[ description = [ for udev ] ]]
        providers:eudev? ( sys-apps/eudev )
"


pkg_setup() {
    export CSC=/usr/$(exhost --target)/bin/mcs
}

src_prepare() {
    # Fix wrong mask for generated sources
    # Rely on ${PKG_CONFIG} instead of pkg-config
    edo sed \
        -e '/^GENERATED_SOURCES/s:\*\.cs:*\/*.cs:' \
        -e '/AC_PATH_PROG(PKG_CONFIG/d' \
        -i configure.ac

    autotools_src_prepare
}

